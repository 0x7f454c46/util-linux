#!/bin/sh

set -e

OUTPUT=syscalls.h
SYSCALL_INCLUDES="
#include <sys/syscall.h>
"

trap 'rm $OUTPUT $OUTPUT.deps' ERR

echo "$SYSCALL_INCLUDES" \
	| "$@" -MD -MF "$OUTPUT.deps" -dM -E - \
	| grep '^#define __NR_' \
	| sed 's/#define __NR_\([^[:space:]]*\).*/UL_SYSCALL("\1", __NR_\1)/' \
	| sort \
	> "$OUTPUT"
